require(["toastr","jquery"],function(e){var o=$("#chat-input");o.find("*").css("height","100%"),o.submit(function(o){o.preventDefault(),$.ajax({type:"POST",crossDomain:!0,dataType:"json",url:"/chat/send",data:$(this).serialize(),error:function(){e.error("Failed to send message!")}}),$(this).find("input, textarea").val("")})}),require(["/_ah/channel/jsapi","toastr","jquery"],function(e,o){function n(){o.error("Chat-room error!")}function t(){o.info("Joined chat-room!")}function a(e){$("#chat-box").append('<div class="list-group-item"><p class="chat-message"><strong>'+e.name+": </strong>"+e.msg+'</p></div><div class="chat-separator"></div>');var o=document.getElementById("chat-box");o.scrollTop=o.scrollHeight}function r(s){s="undefined"!=typeof s?s:0,$.ajax({type:"POST",crossDomain:!0,dataType:"json",url:"/chat/join",success:function(o){e=new goog.appengine.Channel(o.token);var s=e.open();s.onopen=t,s.onmessage=function(e){a(JSON.parse(e.data))},s.onerror=n,s.onclose=r},error:function(){o.error("Failed to join chat-room!"),10>=s&&setTimeout(function(){r(s+1)},2e3)}})}$.ajax({type:"POST",crossDomain:!0,dataType:"json",url:"/chat/history",data:$(this).serialize(),success:function(e){for(var o=e.length-1;o>=0;o--)a(JSON.parse(e[o]))}}),r()});