/* ===========================================================
 * pagepiling.js 1.3
 *
 * https://github.com/alvarotrigo/pagePiling.js
 * MIT licensed
 *
 * Copyright (C) 2013 alvarotrigo.com - A project by Alvaro Trigo
 *
 * ========================================================== */

!function(n,o,t,e){n.fn.pagepiling=function(i){function a(n){n.addClass("pp-table").wrapInner('<div class="pp-tableCell" style="height:100%" />')}function s(o){var t=n(".pp-section.active").index(".pp-section"),e=o.index(".pp-section");return t>e?"up":"down"}function c(o,t){var e={destination:o,animated:t,activeSection:n(".pp-section.active"),anchorLink:o.data("anchor"),sectionIndex:o.index(".pp-section"),toMove:o,yMovement:s(o),leavingSection:n(".pp-section.active").index(".pp-section")+1};if(!e.activeSection.is(o)){"undefined"==typeof e.animated&&(e.animated=!0),"undefined"!=typeof e.anchorLink&&v(e.anchorLink,e.sectionIndex),e.destination.addClass("active").siblings().removeClass("active"),e.sectionsToMove=l(e),"down"===e.yMovement?(e.translate3d=A(),e.scrolling="-100%",options.css3||e.sectionsToMove.each(function(o){o!=e.activeSection.index(".pp-section")&&n(this).css(u(e.scrolling))}),e.animateSection=e.activeSection):(e.translate3d="translate3d(0px, 0px, 0px)",e.scrolling="0",e.animateSection=o),n.isFunction(options.onLeave)&&options.onLeave.call(this,e.leavingSection,e.sectionIndex+1,e.yMovement),r(e),q(e.anchorLink),N(e.anchorLink,e.sectionIndex),O=e.anchorLink;var i=(new Date).getTime();B=i}}function r(o){options.css3?(w(o.animateSection,o.translate3d,o.animated),o.sectionsToMove.each(function(){w(n(this),o.translate3d,o.animated)}),setTimeout(function(){p(o)},options.scrollingSpeed)):(o.scrollOptions=u(o.scrolling),o.animated?o.animateSection.animate(o.scrollOptions,options.scrollingSpeed,options.easing,function(){d(o),p(o)}):(o.animateSection.css(u(o.scrolling)),setTimeout(function(){d(o),p(o)},400)))}function p(o){n.isFunction(options.afterLoad)&&options.afterLoad.call(this,o.anchorLink,o.sectionIndex+1)}function l(o){var t;return t=n(".pp-section").map("down"===o.yMovement?function(t){return t<o.destination.index(".pp-section")?n(this):void 0}:function(t){return t>o.destination.index(".pp-section")?n(this):void 0})}function d(o){var t;return"up"===o.yMovement&&o.sectionsToMove.each(function(){n(this).css(u(o.scrolling))}),t}function u(n){return"vertical"===options.direction?{top:n}:{left:n}}function v(n,o){options.anchors.length?(location.hash=n,h(location.hash)):h(String(o))}function h(o){o=o.replace("#",""),n("body")[0].className=n("body")[0].className.replace(/\b\s?pp-viewing-[^\s]+\b/g,""),n("body").addClass("pp-viewing-"+o)}function f(){var o=t.location.hash.replace("#",""),e=o,i=n('.pp-section[data-anchor="'+e+'"]');i.length>0&&c(i,options.animateAnchor)}function m(){var n=(new Date).getTime();return n-B<R+options.scrollingSpeed?!0:!1}function g(){var o=t.location.hash.replace("#","").split("/"),e=o[0];if(e.length){if(e&&e!==O){if(isNaN(e))var i=n('[data-anchor="'+e+'"]');else var i=n(".pp-section").eq(e-1);c(i)}}}function S(n){return{"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n,transform:n}}function w(n,o,t){n.toggleClass("pp-easing",t),n.css(S(o))}function y(o){if(!m()){o=t.event||o;var e=Math.max(-1,Math.min(1,o.wheelDelta||-o.deltaY||-o.detail)),i=n(".pp-section.active"),a=b(i);return 0>e?x("down",a):x("up",a),!1}}function x(n,o){if("down"==n)var t="bottom",e=U.moveSectionDown;else var t="top",e=U.moveSectionUp;if(o.length>0){if(!isScrolled(t,o))return!0;e()}else e()}function b(n){return scrollable=n.find(".pp-scrollable"),scrollable}function M(){W.get(0).addEventListener?(W.get(0).removeEventListener("mousewheel",y,!1),W.get(0).removeEventListener("wheel",y,!1)):W.get(0).detachEvent("onmousewheel",y)}function E(){W.get(0).addEventListener?(W.get(0).addEventListener("mousewheel",y,!1),W.get(0).addEventListener("wheel",y,!1)):W.get(0).attachEvent("onmousewheel",y)}function T(){F&&(MSPointer=k(),W.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,P),W.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,Y))}function C(){F&&(MSPointer=k(),W.off("touchstart "+MSPointer.down),W.off("touchmove "+MSPointer.move))}function k(){var n;return n=t.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function L(n){var o=new Array;return o.y="undefined"!=typeof n.pageY&&(n.pageY||n.pageX)?n.pageY:n.touches[0].pageY,o.x="undefined"!=typeof n.pageX&&(n.pageY||n.pageX)?n.pageX:n.touches[0].pageX,o}function X(n){return"undefined"==typeof n.pointerType||"mouse"!=n.pointerType}function P(n){var o=n.originalEvent;if(X(o)){var t=L(o);Q=t.y,touchStartX=t.x}}function Y(o){var t=o.originalEvent;if(!D(o.target)&&X(t)){o.preventDefault();var e=n(".pp-section.active"),i=b(e);if(!m()){var a=L(t);touchEndY=a.y,touchEndX=a.x,"horizontal"===options.direction&&Math.abs(touchStartX-touchEndX)>Math.abs(Q-touchEndY)?Math.abs(touchStartX-touchEndX)>W.width()/100*options.touchSensitivity&&(touchStartX>touchEndX?x("down",i):touchEndX>touchStartX&&x("up",i)):Math.abs(Q-touchEndY)>W.height()/100*options.touchSensitivity&&(Q>touchEndY?x("down",i):touchEndY>Q&&x("up",i))}}}function D(o,t){t=t||0;var e=n(o).parent();return t<options.normalScrollElementTouchThreshold&&e.is(options.normalScrollElements)?!0:t==options.normalScrollElementTouchThreshold?!1:D(e,++t)}function I(){n("body").append('<div id="pp-nav"><ul></ul></div>');var o=n("#pp-nav");o.css("color",options.navigation.textColor),o.addClass(options.navigation.position);for(var t=0;t<n(".pp-section").length;t++){var e="";if(options.anchors.length&&(e=options.anchors[t]),"undefined"!==options.navigation.tooltips){var i=options.navigation.tooltips[t];"undefined"==typeof i&&(i="")}o.find("ul").append('<li data-tooltip="'+i+'"><a href="#'+e+'"><span></span></a></li>')}o.find("span").css("border-color",options.navigation.bulletsColor)}function N(o,t){options.navigation&&(n("#pp-nav").find(".active").removeClass("active"),o?n("#pp-nav").find('a[href="#'+o+'"]').addClass("active"):n("#pp-nav").find("li").eq(t).find("a").addClass("active"))}function q(o){options.menu&&(n(options.menu).find(".active").removeClass("active"),n(options.menu).find('[data-menuanchor="'+o+'"]').addClass("active"))}function z(){var n,i=o.createElement("p"),a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};o.body.insertBefore(i,null);for(var s in a)i.style[s]!==e&&(i.style[s]="translate3d(1px,1px,1px)",n=t.getComputedStyle(i).getPropertyValue(a[s]));return o.body.removeChild(i),n!==e&&n.length>0&&"none"!==n}function A(){return"vertical"!==options.direction?"translate3d(-100%, 0px, 0px)":"translate3d(0px, -100%, 0px)"}var O,U=n.fn.pagepiling,W=n(this),B=0,F="ontouchstart"in t||navigator.msMaxTouchPoints>0||navigator.maxTouchPoints,Q=touchStartX=touchEndY=touchEndX=0,R=600;options=n.extend(!0,{direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"easeInQuart",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:[]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,afterLoad:null,onLeave:null,afterRender:null},i),n.extend(n.easing,{easeInQuart:function(n,o,t,e,i){return e*(o/=i)*o*o*o+t}}),U.setScrollingSpeed=function(n){options.scrollingSpeed=n},U.setMouseWheelScrolling=function(n){n?E():M()},U.setAllowScrolling=function(n){n?(U.setMouseWheelScrolling(!0),T()):(U.setMouseWheelScrolling(!1),C())},U.setKeyboardScrolling=function(n){options.keyboardScrolling=n},U.moveSectionUp=function(){var o=n(".pp-section.active").prev(".pp-section");!o.length&&options.loopTop&&(o=n(".pp-section").last()),o.length&&c(o)},U.moveSectionDown=function(){var o=n(".pp-section.active").next(".pp-section");!o.length&&options.loopBottom&&(o=n(".pp-section").first()),o.length&&c(o)},U.moveTo=function(o){var t="";t=isNaN(o)?n('[data-anchor="'+o+'"]'):n(".pp-section").eq(o-1),t.length>0&&c(t)},n(options.sectionSelector).each(function(){n(this).addClass("pp-section")}),options.css3&&(options.css3=z()),n(W).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),U.setAllowScrolling(!0),n.isEmptyObject(options.navigation)||I();var j=n(".pp-section").length;n(".pp-section").each(function(o){n(this).data("data-index",o),n(this).css("z-index",j),o||0!==n(".pp-section.active").length||n(this).addClass("active"),"undefined"!=typeof options.anchors[o]&&n(this).attr("data-anchor",options.anchors[o]),"undefined"!=typeof options.sectionsColor[o]&&n(this).css("background-color",options.sectionsColor[o]),options.verticalCentered&&a(n(this)),j-=1}).promise().done(function(){options.navigation&&(n("#pp-nav").css("margin-top","-"+n("#pp-nav").height()/2+"px"),n("#pp-nav").find("li").eq(n(".pp-section.active").index(".pp-section")).find("a").addClass("active")),n(t).on("load",function(){f()}),n.isFunction(options.afterRender)&&options.afterRender.call(this)}),n(t).on("hashchange",g),n(o).keydown(function(o){if(options.keyboardScrolling&&!m())switch(o.which){case 38:case 33:U.moveSectionUp();break;case 40:case 34:U.moveSectionDown();break;case 36:U.moveTo(1);break;case 35:U.moveTo(n(".pp-section").length);break;case 37:U.moveSectionUp();break;case 39:U.moveSectionDown();break;default:return}}),options.normalScrollElements&&(n(o).on("mouseenter",options.normalScrollElements,function(){U.setMouseWheelScrolling(!1)}),n(o).on("mouseleave",options.normalScrollElements,function(){U.setMouseWheelScrolling(!0)})),n(o).on("click touchstart","#pp-nav a",function(o){o.preventDefault();var t=n(this).parent().index();c(n(".pp-section").eq(t))}),n(o).on({mouseenter:function(){var o=n(this).data("tooltip");n('<div class="pp-tooltip '+options.navigation.position+'">'+o+"</div>").hide().appendTo(n(this)).fadeIn(200)},mouseleave:function(){n(this).find(".pp-tooltip").fadeOut(200,function(){n(this).remove()})}},"#pp-nav li")}}(jQuery,document,window);