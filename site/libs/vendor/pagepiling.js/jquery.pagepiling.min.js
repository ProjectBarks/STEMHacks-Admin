/* ===========================================================
 * pagepiling.js 1.3
 *
 * https://github.com/alvarotrigo/pagePiling.js
 * MIT licensed
 *
 * Copyright (C) 2014 alvarotrigo.com - A project by Alvaro Trigo
 *
 * ========================================================== */

!function(n,o,t,e){n.fn.pagepiling=function(i){function a(o){var t=n(".pp-section.active").index(".pp-section");return o=o.index(".pp-section"),t>o?"up":"down"}function s(o,t){var e={destination:o,animated:t,activeSection:n(".pp-section.active"),anchorLink:o.data("anchor"),sectionIndex:o.index(".pp-section"),toMove:o,yMovement:a(o),leavingSection:n(".pp-section.active").index(".pp-section")+1};e.activeSection.is(o)||("undefined"==typeof e.animated&&(e.animated=!0),"undefined"!=typeof e.anchorLink&&u(e.anchorLink,e.sectionIndex),e.destination.addClass("active").siblings().removeClass("active"),e.sectionsToMove=p(e),"down"===e.yMovement?(e.translate3d="vertical"!==options.direction?"translate3d(-100%, 0px, 0px)":"translate3d(0px, -100%, 0px)",e.scrolling="-100%",options.css3||e.sectionsToMove.each(function(o){o!=e.activeSection.index(".pp-section")&&n(this).css(d(e.scrolling))}),e.animateSection=e.activeSection):(e.translate3d="translate3d(0px, 0px, 0px)",e.scrolling="0",e.animateSection=o),n.isFunction(options.onLeave)&&options.onLeave.call(this,e.leavingSection,e.sectionIndex+1,e.yMovement),c(e),k(e.anchorLink),C(e.anchorLink,e.sectionIndex),X=e.anchorLink,D=(new Date).getTime())}function c(o){options.css3?(f(o.animateSection,o.translate3d,o.animated),o.sectionsToMove.each(function(){f(n(this),o.translate3d,o.animated)}),setTimeout(function(){r(o)},options.scrollingSpeed)):(o.scrollOptions=d(o.scrolling),o.animated?o.animateSection.animate(o.scrollOptions,options.scrollingSpeed,options.easing,function(){l(o),r(o)}):(o.animateSection.css(d(o.scrolling)),setTimeout(function(){l(o),r(o)},400)))}function r(o){n.isFunction(options.afterLoad)&&options.afterLoad.call(this,o.anchorLink,o.sectionIndex+1)}function p(o){return n(".pp-section").map("down"===o.yMovement?function(t){return t<o.destination.index(".pp-section")?n(this):void 0}:function(t){return t>o.destination.index(".pp-section")?n(this):void 0})}function l(o){"up"===o.yMovement&&o.sectionsToMove.each(function(){n(this).css(d(o.scrolling))})}function d(n){return"vertical"===options.direction?{top:n}:{left:n}}function u(n,o){options.anchors.length?(location.hash=n,h(location.hash)):h(String(o))}function h(o){o=o.replace("#",""),n("body")[0].className=n("body")[0].className.replace(/\b\s?pp-viewing-[^\s]+\b/g,""),n("body").addClass("pp-viewing-"+o)}function v(){return(new Date).getTime()-D<600+options.scrollingSpeed?!0:!1}function f(n,o,t){n.toggleClass("pp-easing",t),n.css({"-webkit-transform":o,"-moz-transform":o,"-ms-transform":o,transform:o})}function m(o){if(!v()){o=t.event||o,o=Math.max(-1,Math.min(1,o.wheelDelta||-o.deltaY||-o.detail));var e=n(".pp-section.active"),e=S(e);return 0>o?g("down",e):g("up",e),!1}}function g(n,o){if("down"==n)var t="bottom",e=P.moveSectionDown;else t="top",e=P.moveSectionUp;if(0<o.length){if(!isScrolled(t,o))return!0;e()}else e()}function S(n){return scrollable=n.find(".pp-scrollable")}function w(){return t.PointerEvent?{down:"pointerdown",move:"pointermove",up:"pointerup"}:{down:"MSPointerDown",move:"MSPointerMove",up:"MSPointerUp"}}function y(n){var o=[];return o.y="undefined"!=typeof n.pageY&&(n.pageY||n.pageX)?n.pageY:n.touches[0].pageY,o.x="undefined"!=typeof n.pageX&&(n.pageY||n.pageX)?n.pageX:n.touches[0].pageX,o}function x(n){return"undefined"==typeof n.pointerType||"mouse"!=n.pointerType}function b(n){n=n.originalEvent,x(n)&&(n=y(n),N=n.y,touchStartX=n.x)}function M(o){var t=o.originalEvent;!E(o.target)&&x(t)&&(o.preventDefault(),o=n(".pp-section.active"),o=S(o),v()||(t=y(t),touchEndY=t.y,touchEndX=t.x,"horizontal"===options.direction&&Math.abs(touchStartX-touchEndX)>Math.abs(N-touchEndY)?Math.abs(touchStartX-touchEndX)>Y.width()/100*options.touchSensitivity&&(touchStartX>touchEndX?g("down",o):touchEndX>touchStartX&&g("up",o)):Math.abs(N-touchEndY)>Y.height()/100*options.touchSensitivity&&(N>touchEndY?g("down",o):touchEndY>N&&g("up",o))))}function E(o,t){t=t||0;var e=n(o).parent();return t<options.normalScrollElementTouchThreshold&&e.is(options.normalScrollElements)?!0:t==options.normalScrollElementTouchThreshold?!1:E(e,++t)}function T(){n("body").append('<div id="pp-nav"><ul></ul></div>');var o=n("#pp-nav");o.css("color",options.navigation.textColor),o.addClass(options.navigation.position);for(var t=0;t<n(".pp-section").length;t++){var e="";if(options.anchors.length&&(e=options.anchors[t]),"undefined"!==options.navigation.tooltips){var i=options.navigation.tooltips[t];"undefined"==typeof i&&(i="")}o.find("ul").append('<li data-tooltip="'+i+'"><a href="#'+e+'"><span></span></a></li>')}o.find("span").css("border-color",options.navigation.bulletsColor)}function C(o,t){options.navigation&&(n("#pp-nav").find(".active").removeClass("active"),o?n("#pp-nav").find('a[href="#'+o+'"]').addClass("active"):n("#pp-nav").find("li").eq(t).find("a").addClass("active"))}function k(o){options.menu&&(n(options.menu).find(".active").removeClass("active"),n(options.menu).find('[data-menuanchor="'+o+'"]').addClass("active"))}function L(){var n,i=o.createElement("p"),a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};o.body.insertBefore(i,null);for(var s in a)i.style[s]!==e&&(i.style[s]="translate3d(1px,1px,1px)",n=t.getComputedStyle(i).getPropertyValue(a[s]));return o.body.removeChild(i),n!==e&&0<n.length&&"none"!==n}var X,P=n.fn.pagepiling,Y=n(this),D=0,I="ontouchstart"in t||0<navigator.msMaxTouchPoints||navigator.maxTouchPoints,N=touchStartX=touchEndY=touchEndX=0;options=n.extend(!0,{direction:"vertical",menu:null,verticalCentered:!0,sectionsColor:[],anchors:[],scrollingSpeed:700,easing:"easeInQuart",loopBottom:!1,loopTop:!1,css3:!0,navigation:{textColor:"#000",bulletsColor:"#000",position:"right",tooltips:[]},normalScrollElements:null,normalScrollElementTouchThreshold:5,touchSensitivity:5,keyboardScrolling:!0,sectionSelector:".section",animateAnchor:!1,afterLoad:null,onLeave:null,afterRender:null},i),n.extend(n.easing,{easeInQuart:function(n,o,t,e,i){return e*(o/=i)*o*o*o+t}}),P.setScrollingSpeed=function(n){options.scrollingSpeed=n},P.setMouseWheelScrolling=function(n){n?Y.get(0).addEventListener?(Y.get(0).addEventListener("mousewheel",m,!1),Y.get(0).addEventListener("wheel",m,!1)):Y.get(0).attachEvent("onmousewheel",m):Y.get(0).addEventListener?(Y.get(0).removeEventListener("mousewheel",m,!1),Y.get(0).removeEventListener("wheel",m,!1)):Y.get(0).detachEvent("onmousewheel",m)},P.setAllowScrolling=function(n){n?(P.setMouseWheelScrolling(!0),I&&(MSPointer=w(),Y.off("touchstart "+MSPointer.down).on("touchstart "+MSPointer.down,b),Y.off("touchmove "+MSPointer.move).on("touchmove "+MSPointer.move,M))):(P.setMouseWheelScrolling(!1),I&&(MSPointer=w(),Y.off("touchstart "+MSPointer.down),Y.off("touchmove "+MSPointer.move)))},P.setKeyboardScrolling=function(n){options.keyboardScrolling=n},P.moveSectionUp=function(){var o=n(".pp-section.active").prev(".pp-section");!o.length&&options.loopTop&&(o=n(".pp-section").last()),o.length&&s(o)},P.moveSectionDown=function(){var o=n(".pp-section.active").next(".pp-section");!o.length&&options.loopBottom&&(o=n(".pp-section").first()),o.length&&s(o)},P.moveTo=function(o){var t="",t=isNaN(o)?n('[data-anchor="'+o+'"]'):n(".pp-section").eq(o-1);0<t.length&&s(t)},n(options.sectionSelector).each(function(){n(this).addClass("pp-section")}),options.css3&&(options.css3=L()),n(Y).css({overflow:"hidden","-ms-touch-action":"none","touch-action":"none"}),P.setAllowScrolling(!0),n.isEmptyObject(options.navigation)||T();var q=n(".pp-section").length;n(".pp-section").each(function(o){n(this).data("data-index",o),n(this).css("z-index",q),o||0!==n(".pp-section.active").length||n(this).addClass("active"),"undefined"!=typeof options.anchors[o]&&n(this).attr("data-anchor",options.anchors[o]),"undefined"!=typeof options.sectionsColor[o]&&n(this).css("background-color",options.sectionsColor[o]),options.verticalCentered&&n(this).addClass("pp-table").wrapInner('<div class="pp-tableCell" style="height:100%" />'),--q}).promise().done(function(){options.navigation&&(n("#pp-nav").css("margin-top","-"+n("#pp-nav").height()/2+"px"),n("#pp-nav").find("li").eq(n(".pp-section.active").index(".pp-section")).find("a").addClass("active")),n(t).on("load",function(){var o=t.location.hash.replace("#",""),o=n('.pp-section[data-anchor="'+o+'"]');0<o.length&&s(o,options.animateAnchor)}),n.isFunction(options.afterRender)&&options.afterRender.call(this)}),n(t).on("hashchange",function(){var o=t.location.hash.replace("#","").split("/")[0];o.length&&o&&o!==X&&(o=isNaN(o)?n('[data-anchor="'+o+'"]'):n(".pp-section").eq(o-1),s(o))}),n(o).keydown(function(o){if(options.keyboardScrolling&&!v())switch(o.which){case 38:case 33:P.moveSectionUp();break;case 40:case 34:P.moveSectionDown();break;case 36:P.moveTo(1);break;case 35:P.moveTo(n(".pp-section").length);break;case 37:P.moveSectionUp();break;case 39:P.moveSectionDown()}}),options.normalScrollElements&&(n(o).on("mouseenter",options.normalScrollElements,function(){P.setMouseWheelScrolling(!1)}),n(o).on("mouseleave",options.normalScrollElements,function(){P.setMouseWheelScrolling(!0)})),n(o).on("click touchstart","#pp-nav a",function(o){o.preventDefault(),o=n(this).parent().index(),s(n(".pp-section").eq(o))}),n(o).on({mouseenter:function(){var o=n(this).data("tooltip");n('<div class="pp-tooltip '+options.navigation.position+'">'+o+"</div>").hide().appendTo(n(this)).fadeIn(200)},mouseleave:function(){n(this).find(".pp-tooltip").fadeOut(200,function(){n(this).remove()})}},"#pp-nav li")}}(jQuery,document,window);